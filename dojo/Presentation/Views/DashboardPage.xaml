<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Presentation.ViewModels"
             xmlns:models="clr-namespace:Presentation.Models"
             xmlns:controls="clr-namespace:Presentation.Controls"
             x:Class="Presentation.Views.DashboardPage"
             x:DataType="viewmodels:MainViewModel"
             Title="DOJO - Планувальник"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="60,*" ColumnDefinitions="*,340">
        
        <!-- Top Toolbar -->
        <Border 
            Grid.Row="0" 
            Grid.ColumnSpan="2"
            BackgroundColor="White"
            Shadow="{Shadow Brush=Black, Opacity=0.1, Radius=5, Offset='0,2'}">
            <Grid Padding="15,0" ColumnDefinitions="Auto,*,Auto">
                
                <!-- Left Buttons -->
                <HorizontalStackLayout Grid.Column="0" Spacing="10">
                    <Button 
                        Text="+ Додати план"
                        Command="{Binding AddPlanCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Padding="15,8"/>
                    
                    <Button 
                        Text="TODO"
                        Style="{StaticResource OutlineButtonStyle}"
                        Padding="12,8"/>
                    
                    <Button 
                        Text="Статистика"
                        Command="{Binding NavigateToStatisticsCommand}"
                        Style="{StaticResource OutlineButtonStyle}"
                        Padding="12,8"/>
                </HorizontalStackLayout>

                <!-- Center - Date Navigation -->
                <HorizontalStackLayout 
                    Grid.Column="1" 
                    Spacing="15"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                    
                    <Button 
                        Text="◀"
                        Command="{Binding NavigatePreviousCommand}"
                        Style="{StaticResource ArrowButtonStyle}"/>
                    
                    <Label 
                        Text="{Binding DateRangeText}"
                        FontSize="18"
                        FontAttributes="Bold"
                        VerticalOptions="Center"
                        TextColor="#333"/>
                    
                    <Button 
                        Text="▶"
                        Command="{Binding NavigateNextCommand}"
                        Style="{StaticResource ArrowButtonStyle}"/>
                </HorizontalStackLayout>

                <!-- Right - View Mode and Profile -->
                <HorizontalStackLayout Grid.Column="2" Spacing="10">
                    <!-- Profile Icon -->
                    <Border 
                        Style="{StaticResource ProfileBorderStyle}"
                        VerticalOptions="Center">
                        <Label 
                            Text="{Binding UserInitials}"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"/>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnProfileTapped"/>
                        </Border.GestureRecognizers>
                    </Border>

                    <Label 
                        Text="{Binding UserName}"
                        FontSize="14"
                        FontAttributes="Bold"
                        TextColor="#333"
                        VerticalOptions="Center"
                        Margin="0,0,15,0"/>

                    <Border 
                        BackgroundColor="#F0F0F0"
                        Padding="2"
                        StrokeShape="RoundRectangle 5"
                        Stroke="Transparent">
                        <HorizontalStackLayout Spacing="0">
                            <Button 
                                Text="День"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Day"
                                Style="{StaticResource ViewModeButtonStyle}"
                                BackgroundColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToColorConverter}, ConverterParameter=Day}"
                                TextColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToTextColorConverter}, ConverterParameter=Day}"/>
                            <Button 
                                Text="Тиждень"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Week"
                                Style="{StaticResource ViewModeButtonStyle}"
                                BackgroundColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToColorConverter}, ConverterParameter=Week}"
                                TextColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToTextColorConverter}, ConverterParameter=Week}"/>
                            <Button 
                                Text="Місяць"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Month"
                                Style="{StaticResource ViewModeButtonStyle}"
                                BackgroundColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToColorConverter}, ConverterParameter=Month}"
                                TextColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToTextColorConverter}, ConverterParameter=Month}"/>
                        </HorizontalStackLayout>
                    </Border>
                    
                    <Button 
                        Text="Сьогодні"
                        Command="{Binding GoToTodayCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Padding="12,8"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Grid.Column="0" Padding="10">
            <ScrollView>
                <VerticalStackLayout Spacing="15">
                    
                    <!-- Day Schedule Grid -->
                    <ScrollView 
                        HeightRequest="600"
                        IsVisible="{Binding CurrentViewMode, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Day}">
                        <Border 
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="0"
                            StrokeShape="RoundRectangle 8">
                            <controls:DayScheduleGrid 
                                x:Name="DaySchedule"
                                Events="{Binding Events}"
                                SelectedDate="{Binding SelectedDate}"/>
                        </Border>
                    </ScrollView>
                    
                    <!-- Week Schedule Grid -->
                    <Border 
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="1"
                        Padding="0"
                        StrokeShape="RoundRectangle 8"
                        HeightRequest="600"
                        IsVisible="{Binding CurrentViewMode, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Week}">
                        <controls:WeekScheduleGrid 
                            x:Name="WeekSchedule"
                            Events="{Binding Events}"
                            WeekStartDate="{Binding WeekStartDate}"/>
                    </Border>

                    <!-- Month View Grid -->
                    <Border 
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="1"
                        Padding="10"
                        StrokeShape="RoundRectangle 8"
                        IsVisible="{Binding CurrentViewMode, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Month}">
                        <controls:MonthViewGrid 
                            x:Name="MonthView"
                            Events="{Binding Events}"
                            SelectedDate="{Binding SelectedDate}"/>
                    </Border>

                    <!-- Bottom Cards Row -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15">
                        
                        <!-- Plan Card -->
                        <Border 
                            Grid.Column="0"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="ПЛАН"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <CollectionView ItemsSource="{Binding Events}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:EventModel">
                                            <HorizontalStackLayout Spacing="8" Padding="0,5">
                                                <CheckBox IsChecked="{Binding IsCompleted}"/>
                                                <Label 
                                                    Text="{Binding Title}"
                                                    FontSize="14"
                                                    VerticalOptions="Center"
                                                    TextColor="#666"/>
                                            </HorizontalStackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- To Do Card -->
                        <Border 
                            Grid.Column="1"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="TO DO"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <CollectionView ItemsSource="{Binding TodoItems}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:TodoItemModel">
                                            <HorizontalStackLayout Spacing="8" Padding="0,5">
                                                <CheckBox 
                                                    IsChecked="{Binding IsCompleted}">
                                                    <CheckBox.GestureRecognizers>
                                                        <TapGestureRecognizer 
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=ToggleTodoCommand}"
                                                            CommandParameter="{Binding .}"/>
                                                    </CheckBox.GestureRecognizers>
                                                </CheckBox>
                                                <Label 
                                                    Text="{Binding Description}"
                                                    FontSize="14"
                                                    VerticalOptions="Center"
                                                    TextColor="#666"
                                                    TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorationConverter}}"/>
                                            </HorizontalStackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                
                                <Button 
                                    Text="+ Додати завдання"
                                    Style="{StaticResource AddButtonStyle}"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Statistics Card -->
                        <Border 
                            Grid.Column="2"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="СТАТИСТИКА"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <Label 
                                    Text="Завершено завдань: 12"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Label 
                                    Text="Час роботи: 8 год"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Label 
                                    Text="Продуктивність: 85%"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Button 
                                    Text="Детальніше"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="10,5"
                                    FontSize="12"
                                    Margin="0,10,0,0"/>
                            </VerticalStackLayout>
                        </Border>
                    </Grid>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>

        <!-- Right Sidebar -->
        <Border 
            Grid.Row="1" 
            Grid.Column="1"
            BackgroundColor="White"
            Stroke="#E0E0E0"
            StrokeThickness="1"
            Padding="15"
            Margin="0,10,10,10"
            StrokeShape="RoundRectangle 8">
            <VerticalStackLayout Spacing="20">
                
                <!-- Mini Calendar -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="Календар"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <Border 
                        BackgroundColor="White"
                        Padding="12,12"
                        StrokeShape="RoundRectangle 8"
                        Stroke="#E0E0E0"
                        StrokeThickness="1">
                        <VerticalStackLayout Spacing="10">
                            <!-- Calendar Header with Month/Year -->
                            <HorizontalStackLayout HorizontalOptions="Center" Spacing="10">
                                <Button 
                                    Text="◀"
                                    BackgroundColor="Transparent"
                                    TextColor="#666"
                                    FontSize="14"
                                    WidthRequest="30"
                                    HeightRequest="30"
                                    Padding="0"
                                    Command="{Binding PreviousMonthCommand}"/>
                                
                                <Label 
                                    Text="{Binding CurrentMonthYear}"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    TextColor="#333"
                                    VerticalOptions="Center"
                                    MinimumWidthRequest="120"
                                    HorizontalTextAlignment="Center"/>
                                
                                <Button 
                                    Text="▶"
                                    BackgroundColor="Transparent"
                                    TextColor="#666"
                                    FontSize="14"
                                    WidthRequest="30"
                                    HeightRequest="30"
                                    Padding="0"
                                    Command="{Binding NextMonthCommand}"/>
                            </HorizontalStackLayout>
                            
                            <!-- Days of Week Header -->
                            <Grid ColumnDefinitions="*,*,*,*,*,*,*" ColumnSpacing="2" Margin="0,5,0,5">
                                <Label Grid.Column="0" Text="Пн" FontSize="10" TextColor="#999" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="1" Text="Вт" FontSize="10" TextColor="#999" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="2" Text="Ср" FontSize="10" TextColor="#999" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="3" Text="Чт" FontSize="10" TextColor="#999" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="4" Text="Пт" FontSize="10" TextColor="#999" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="5" Text="Сб" FontSize="10" TextColor="#E91E63" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="6" Text="Нд" FontSize="10" TextColor="#E91E63" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                            </Grid>
                            
                            <!-- Calendar Days Grid -->
                            <CollectionView 
                                ItemsSource="{Binding CalendarDays}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedCalendarDay}"
                                SelectionChanged="OnCalendarDaySelectionChanged"
                                HeightRequest="240"
                                HorizontalOptions="Center">
                                <CollectionView.ItemsLayout>
                                    <GridItemsLayout 
                                        Orientation="Vertical" 
                                        Span="7"
                                        HorizontalItemSpacing="2"
                                        VerticalItemSpacing="3"/>
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:CalendarDayModel">
                                        <Border 
                                            BackgroundColor="{Binding BackgroundColor}"
                                            Padding="4"
                                            HeightRequest="40"
                                            WidthRequest="40"
                                            StrokeShape="RoundRectangle 4"
                                            Stroke="{Binding BorderColor}"
                                            StrokeThickness="1"
                                            HorizontalOptions="Fill"
                                            VerticalOptions="Fill">
                                            <Grid>
                                                <Label 
                                                    Text="{Binding Day}"
                                                    FontSize="12"
                                                    TextColor="{Binding TextColor}"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="Center"
                                                    FontAttributes="{Binding FontAttributes}"/>
                                                <!-- Event Indicator Dot -->
                                                <Ellipse 
                                                    Fill="{Binding EventDotColor}"
                                                    WidthRequest="4"
                                                    HeightRequest="4"
                                                    HorizontalOptions="Center"
                                                    VerticalOptions="End"
                                                    Margin="0,0,0,3"
                                                    IsVisible="{Binding ShowEventDot}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- Pomodoro Timer -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="Помодоро"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <Border 
                        BackgroundColor="#FFF3E0"
                        Padding="20"
                        StrokeShape="RoundRectangle 8"
                        Stroke="#FFB74D">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Label 
                                Text="{Binding PomodoroTimeText}"
                                FontSize="32"
                                FontAttributes="Bold"
                                HorizontalOptions="Center"
                                TextColor="{StaticResource Raspberry}"/>
                            
                            <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                                <Button 
                                    Text="{Binding TimerButtonText}"
                                    BackgroundColor="{StaticResource HotPink}"
                                    Style="{StaticResource PomodoroButtonStyle}"
                                    Command="{Binding StartPomodoroCommand}"/>
                                <Button 
                                    Text="↻"
                                    BackgroundColor="#F44336"
                                    Style="{StaticResource PomodoroButtonStyle}"
                                    Command="{Binding ResetPomodoroCommand}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- Mascot -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="Твій герой"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <Border 
                        BackgroundColor="{StaticResource SoftPink}"
                        Padding="20"
                        StrokeShape="RoundRectangle 8"
                        Stroke="{StaticResource HotPink}"
                        HeightRequest="150">
                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                            <!-- Тут можна замінити на Image з Figma: <Image Source="pig.png" .../> -->
                            <Label 
                                Text="(^_^)"
                                FontSize="40"
                                HorizontalOptions="Center"
                                TextColor="{StaticResource HotPink}"/>
                            <Label 
                                Text="Рівень 5"
                                FontSize="14"
                                HorizontalOptions="Center"
                                TextColor="{StaticResource HotPink}"
                                FontAttributes="Bold"/>
                            <ProgressBar 
                                Progress="0.65"
                                ProgressColor="{StaticResource MediumPink}"
                                Margin="0,10,0,0"
                                WidthRequest="150"/>
                            <Label 
                                Text="650 / 1000 XP"
                                FontSize="12"
                                HorizontalOptions="Center"
                                TextColor="#666"/>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </Border>

    </Grid>

</ContentPage>