<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Presentation.ViewModels"
             xmlns:controls="clr-namespace:Presentation.Controls"
             x:Class="Presentation.Views.DashboardPage"
             x:DataType="viewmodels:MainViewModel"
             Title="DOJO - ÐŸÐ»Ð°Ð½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ðº"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="60,*" ColumnDefinitions="*,300">
        
        <!-- Top Toolbar -->
        <Border 
            Grid.Row="0" 
            Grid.ColumnSpan="2"
            BackgroundColor="White"
            Shadow="{Shadow Brush=Black, Opacity=0.1, Radius=5, Offset='0,2'}">
            <Grid Padding="15,0" ColumnDefinitions="Auto,*,Auto">
                
                <!-- Left Buttons -->
                <HorizontalStackLayout Grid.Column="0" Spacing="10">
                    <Button 
                        Text="+ Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð¿Ð»Ð°Ð½"
                        Command="{Binding AddPlanCommand}"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Padding="15,8"/>
                    
                    <Button 
                        Text="ðŸ“‹ TODO"
                        Style="{StaticResource OutlineButtonStyle}"
                        Padding="12,8"/>
                    
                    <Button 
                        Text="ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°"
                        Command="{Binding NavigateToStatisticsCommand}"
                        Style="{StaticResource OutlineButtonStyle}"
                        Padding="12,8"/>
                </HorizontalStackLayout>

                <!-- Center - Date Navigation -->
                <HorizontalStackLayout 
                    Grid.Column="1" 
                    Spacing="15"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                    
                    <Button 
                        Text="â—€"
                        Command="{Binding NavigatePreviousCommand}"
                        Style="{StaticResource ArrowButtonStyle}"/>
                    
                    <Label 
                        Text="{Binding DateRangeText}"
                        FontSize="18"
                        FontAttributes="Bold"
                        VerticalOptions="Center"
                        TextColor="#333"/>
                    
                    <Button 
                        Text="â–¶"
                        Command="{Binding NavigateNextCommand}"
                        Style="{StaticResource ArrowButtonStyle}"/>
                </HorizontalStackLayout>

                <!-- Right - View Mode and Profile -->
                <HorizontalStackLayout Grid.Column="2" Spacing="10">
                    <!-- Profile Icon -->
                    <Border 
                        Style="{StaticResource ProfileBorderStyle}"
                        VerticalOptions="Center">
                        <Label 
                            Text="{Binding UserInitials}"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="White"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"/>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnProfileTapped"/>
                        </Border.GestureRecognizers>
                    </Border>

                    <Label 
                        Text="{Binding UserName}"
                        FontSize="14"
                        FontAttributes="Bold"
                        TextColor="#333"
                        VerticalOptions="Center"
                        Margin="0,0,15,0"/>

                    <Border 
                        BackgroundColor="#F0F0F0"
                        Padding="2"
                        StrokeShape="RoundRectangle 5"
                        Stroke="Transparent">
                        <HorizontalStackLayout Spacing="0">
                            <Button 
                                Text="Ð”ÐµÐ½ÑŒ"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Day"
                                Style="{StaticResource ViewModeButtonStyle}"
                                BackgroundColor="{Binding CurrentViewMode, Converter={StaticResource ViewModeToColorConverter}, ConverterParameter=Day}"/>
                            <Button 
                                Text="Ð¢Ð¸Ð¶Ð´ÐµÐ½ÑŒ"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Week"
                                Style="{StaticResource ViewModeButtonStyle}"
                                BackgroundColor="#4CAF50"
                                TextColor="White"/>
                            <Button 
                                Text="ÐœÑ–ÑÑÑ†ÑŒ"
                                Command="{Binding ChangeModeCommand}"
                                CommandParameter="Month"
                                Style="{StaticResource ViewModeButtonStyle}"/>
                        </HorizontalStackLayout>
                    </Border>
                    
                    <Button 
                        Text="Ð¡ÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ–"
                        Command="{Binding GoToTodayCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Padding="12,8"/>
                </HorizontalStackLayout>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Grid.Column="0" Padding="10">
            <ScrollView>
                <VerticalStackLayout Spacing="15">
                    
                    <!-- Week Schedule Grid -->
                    <Border 
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="1"
                        Padding="0"
                        StrokeShape="RoundRectangle 8"
                        HeightRequest="600">
                        <controls:WeekScheduleGrid 
                            Events="{Binding Events}"
                            WeekStartDate="{Binding WeekStartDate}"/>
                    </Border>

                    <!-- Bottom Cards Row -->
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15">
                        
                        <!-- Plan Card -->
                        <Border 
                            Grid.Column="0"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="ðŸ“‹ ÐŸÐ›ÐÐ"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <CollectionView ItemsSource="{Binding Events}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <HorizontalStackLayout Spacing="8" Padding="0,5">
                                                <CheckBox IsChecked="{Binding IsCompleted}"/>
                                                <Label 
                                                    Text="{Binding Title}"
                                                    FontSize="14"
                                                    VerticalOptions="Center"
                                                    TextColor="#666"/>
                                            </HorizontalStackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Border>

                        <!-- To Do Card -->
                        <Border 
                            Grid.Column="1"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="âœ“ TO DO"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <CollectionView ItemsSource="{Binding TodoItems}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <HorizontalStackLayout Spacing="8" Padding="0,5">
                                                <CheckBox 
                                                    IsChecked="{Binding IsCompleted}">
                                                    <CheckBox.GestureRecognizers>
                                                        <TapGestureRecognizer 
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=ToggleTodoCommand}"
                                                            CommandParameter="{Binding .}"/>
                                                    </CheckBox.GestureRecognizers>
                                                </CheckBox>
                                                <Label 
                                                    Text="{Binding Description}"
                                                    FontSize="14"
                                                    VerticalOptions="Center"
                                                    TextColor="#666"
                                                    TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorationConverter}}"/>
                                            </HorizontalStackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                                
                                <Button 
                                    Text="+ Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ"
                                    Style="{StaticResource AddButtonStyle}"/>
                            </VerticalStackLayout>
                        </Border>

                        <!-- Statistics Card -->
                        <Border 
                            Grid.Column="2"
                            BackgroundColor="White"
                            Stroke="#E0E0E0"
                            StrokeThickness="1"
                            Padding="15"
                            StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="10">
                                <Label 
                                    Text="ðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    TextColor="#333"/>
                                
                                <Label 
                                    Text="Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾ Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ: 12"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Label 
                                    Text="Ð§Ð°Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸: 8 Ð³Ð¾Ð´"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Label 
                                    Text="ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ñ–ÑÑ‚ÑŒ: 85%"
                                    FontSize="14"
                                    TextColor="#666"/>
                                
                                <Button 
                                    Text="Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ–ÑˆÐµ"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Padding="10,5"
                                    FontSize="12"
                                    Margin="0,10,0,0"/>
                            </VerticalStackLayout>
                        </Border>
                    </Grid>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>

        <!-- Right Sidebar -->
        <Border 
            Grid.Row="1" 
            Grid.Column="1"
            BackgroundColor="White"
            Stroke="#E0E0E0"
            StrokeThickness="1"
            Padding="15"
            Margin="0,10,10,10"
            StrokeShape="RoundRectangle 8">
            <VerticalStackLayout Spacing="20">
                
                <!-- Mini Calendar -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <!-- Calendar placeholder - will implement custom control -->
                    <Border 
                        BackgroundColor="#F9F9F9"
                        Padding="10"
                        StrokeShape="RoundRectangle 5"
                        Stroke="Transparent"
                        HeightRequest="250">
                        <Label 
                            Text="ÐœÑ–Ð½Ñ–-ÐºÐ°Ð»ÐµÐ½Ð´Ð°Ñ€"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            TextColor="#999"/>
                    </Border>
                </VerticalStackLayout>

                <!-- Pomodoro Timer -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="â±ï¸ ÐŸÐ¾Ð¼Ð¾Ð´Ð¾Ñ€Ð¾"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <Border 
                        BackgroundColor="#FFF3E0"
                        Padding="20"
                        StrokeShape="RoundRectangle 8"
                        Stroke="#FFB74D">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Label 
                                Text="{Binding PomodoroTimeText}"
                                FontSize="32"
                                FontAttributes="Bold"
                                HorizontalOptions="Center"
                                TextColor="#FF6F00"/>
                            
                            <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                                <Button 
                                    Text="{Binding TimerButtonText}"
                                    BackgroundColor="#4CAF50"
                                    Style="{StaticResource PomodoroButtonStyle}"
                                    Command="{Binding StartPomodoroCommand}"/>
                                <Button 
                                    Text="â†»"
                                    BackgroundColor="#F44336"
                                    Style="{StaticResource PomodoroButtonStyle}"
                                    Command="{Binding ResetPomodoroCommand}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- Mascot -->
                <VerticalStackLayout Spacing="10">
                    <Label 
                        Text="ðŸ· Ð¢Ð²Ñ–Ð¹ Ð³ÐµÑ€Ð¾Ð¹"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="#333"/>
                    
                    <Border 
                        BackgroundColor="#E8F5E9"
                        Padding="20"
                        StrokeShape="RoundRectangle 8"
                        Stroke="#4CAF50"
                        HeightRequest="150">
                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                            <Label 
                                Text="ðŸ·"
                                FontSize="60"
                                HorizontalOptions="Center"/>
                            <Label 
                                Text="Ð Ñ–Ð²ÐµÐ½ÑŒ 5"
                                FontSize="14"
                                HorizontalOptions="Center"
                                TextColor="#4CAF50"
                                FontAttributes="Bold"/>
                            <ProgressBar 
                                Progress="0.65"
                                ProgressColor="#4CAF50"
                                Margin="0,10,0,0"
                                WidthRequest="150"/>
                            <Label 
                                Text="650 / 1000 XP"
                                FontSize="12"
                                HorizontalOptions="Center"
                                TextColor="#666"/>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </Border>

    </Grid>

</ContentPage>

